<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transliterations</title>
    <style>
        #content {
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 2.5em; /* Adjust line spacing */
            text-align: center;
        }

        .word-box {
            background-color: rgba(135, 206, 250, 0.5); /* Translucent blue color */
            padding: 0.2em 0.5em;
            border-radius: 4px;
            display: inline-block;
            position: relative; /* Make the word-box position relative to position the transliteration */
        }

        .transliteration {
            position: absolute;
            bottom: -1em;
            left: 0;
            font-size: 0.8em;
            color: inherit; /* Changed to the color of the text */
        }

        #controls {
            margin-top: 20px;
            text-align: center;
        }

        button {
            padding: 5px 15px;
            margin: 5px;
        }
    </style>
</head>

<body>

    <div id="content"></div>

    <div id="controls">
        <button onclick="adjustFontSize(0.1)">+</button>
        <button onclick="adjustFontSize(-0.1)">-</button>
        <button onclick="showAllTransliterations()">BG</button>
        <button onclick="clearTransliterations()">ðŸ§¹</button>
    </div>

    <script>
        function loadText(callback) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'pt.txt', true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    if (xhr.status == 200) {
                        callback(xhr.responseText);
                    } else {
                        console.error("Error loading pt.txt:", xhr.statusText);
                    }
                }
            };
            xhr.send();
        }

        function loadTransliterations(callback) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'transliterations.json', true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    if (xhr.status == 200) {
                        callback(JSON.parse(xhr.responseText));
                    } else {
                        console.error("Error loading transliterations.json:", xhr.statusText);
                    }
                }
            };
            xhr.send();
        }

        function displayText() {
            loadText(function (text) {
                if (!text) {
                    console.error("No text loaded from pt.txt");
                    return;
                }

                loadTransliterations(function (transliterations) {
                    if (!transliterations) {
                        console.error("No transliterations loaded");
                        return;
                    }

                    let htmlContent = text.split(/(\s+|\n)/).map(segment => {
                        if (segment === '\n') {
                            return segment;
                        }
                        let cleanSegment = segment.toLowerCase().replace(/[\n,.\d:;?â€˜â€™]/g, '');
                        if (transliterations[cleanSegment]) {
                            return `<span class="word-box" onclick="showTransliteration(this, '${transliterations[cleanSegment]}')">${segment}</span>`;
                        } else {
                            return segment;
                        }
                    }).join('');

                    document.getElementById('content').innerHTML = htmlContent;
                });
            });
        }

        function showTransliteration(element, transliteration) {
            if (!element.querySelector('.transliteration')) {
                let translitElem = document.createElement('div');
                translitElem.className = 'transliteration';
                translitElem.textContent = transliteration;
                element.appendChild(translitElem);
            }
        }

        function adjustFontSize(delta) {
            let elems = document.querySelectorAll('.transliteration');
            elems.forEach(elem => {
                let currentSize = parseFloat(window.getComputedStyle(elem, null).getPropertyValue('font-size'));
                elem.style.fontSize = (currentSize + delta) + "em";
            });
        }

        function showAllTransliterations() {
            let wordBoxes = document.querySelectorAll('.word-box');
            wordBoxes.forEach(box => {
                let transliteration = box.getAttribute('data-transliteration');
                if (transliteration) {
                    showTransliteration(box, transliteration);
                }
            });
        }

        function clearTransliterations() {
            let transliterations = document.querySelectorAll('.transliteration');
            transliterations.forEach(translit => {
                translit.remove();
            });
        }

        displayText();
    </script>

</body>

</html>
