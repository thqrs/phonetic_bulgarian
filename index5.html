<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transliterations</title>
    <style>
        #content {
            white-space: pre-wrap;  
            word-wrap: break-word; 
            line-height: 2.5em; /* Adjust line spacing */
        }
        .word-box {
            background-color: rgba(135,206,250, 0.5); /* Translucent blue color */
            padding: 0.2em 0.5em;
            border-radius: 4px;
            display: inline-block;
            position: relative; /* Make the word-box position relative to position the transliteration */
        }
        .transliteration {
            position: absolute;
            bottom: -1em;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
        }
        .button-container {
        position: sticky;
        top: 0;  /* This ensures the container sticks to the top */
        background-color: white;  /* This ensures the text behind doesn't overlap when scrolling */
        z-index: 1000;  /* This ensures the container is above other elements */
        padding: 10px;  /* Optional: for some spacing */
        margin-bottom: 20px;  /* Adjust as needed */
        }
        button {
        font-size: 18px;      /* Increase font size to make the button text bigger */
        padding: 10px 20px;  /* Adjust padding for bigger buttons */
        border-radius: 25px; /* Add border-radius to make the buttons rounder */
        border: none;        /* Remove default browser styling for borders */
        cursor: pointer;     /* Change the cursor to a hand when hovering over the button */
        margin-right: 10px;  /* Add some spacing between the buttons */
        transition: background-color 0.3s;  /* Smooth transition for hover effect */
        }
    
        button:hover {
        background-color: #e0e0e0;  /* Slight grey background when hovering */
        }
        .file-selector-container {
    position: sticky;
    bottom: 0;
    background-color: white;  /* To ensure the content behind doesn't show through when scrolling */
    padding: 10px;            /* Some spacing around the dropdown */
    box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);  /* Optional: to give a slight shadow for aesthetics */
    z-index: 1000;            /* To ensure it's above other content */
}
    </style>
</head>
<body>

<div class="button-container">
    <button id="loadAllTransliterations" onclick="showAllTransliterations()">üëì</button>
    <button id="clearAllTransliterations" onclick="clearAllTransliterations()">‚ùå</button>
    <button id="increaseFontSize" onclick="adjustFontSize(1.1)">‚ûï</button>
    <button id="decreaseFontSize" onclick="adjustFontSize(0.9)">‚ûñ</button>
</div>



    
<div id="content"></div>

<!-- Dropdown for file selection -->
<div class="file-selector-container">
    <select id="fileSelector" onchange="loadSelectedFile()">
        <!-- Options will be populated by JavaScript -->
    </select>
</div>


<script>
    function adjustFontSize(multiplier) {
    let contentDiv = document.getElementById('content');
    // Get the current font size of the content
    let currentSize = window.getComputedStyle(contentDiv, null).getPropertyValue('font-size');
    let newSize = parseFloat(currentSize) * multiplier;  // Adjust the font size
    contentDiv.style.fontSize = `${newSize}px`;  // Set the new font size
}
    // Function to populate the dropdown
function populateDropdown(files) {
    const selector = document.getElementById('fileSelector');
    files.forEach(file => {
        let option = document.createElement('option');
        option.value = file;
        option.textContent = file;
        selector.appendChild(option);
    });
}

// Function to load the list of .txt files
function loadFileList() {
    fetch('files.json')
        .then(response => response.json())
        .then(data => {
            populateDropdown(data.files);
            loadSelectedFile();  // Load the default file on page load
        })
        .catch(error => console.error("Error loading files list:", error));
}

function loadSelectedFile() {
    let selectedFile = document.getElementById('fileSelector').value;
    loadText(selectedFile, displayText); // Pass the selected file to the loadText function
}

// Call the function to load the file list
loadFileList();
    
    // Load the text from pt.txt
    function loadText(callback) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', 'pt.txt', true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4) {
                if (xhr.status == 200) {
                    callback(xhr.responseText);
                } else {
                    console.error("Error loading pt.txt:", xhr.statusText);
                }
            }
        };
        xhr.send();
    }

    // Load the transliterations from transliterations.json
    function loadTransliterations(callback) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', 'transliterations.json', true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4) {
                if (xhr.status == 200) {
                    callback(JSON.parse(xhr.responseText));
                } else {
                    console.error("Error loading transliterations.json:", xhr.statusText);
                }
            }
        };
        xhr.send();
    }

function toggleTransliteration(element) {
    let translitElem = element.querySelector('.transliteration');
    let transliteration = element.getAttribute('data-transliteration');

    if (!translitElem && transliteration) {
        translitElem = document.createElement('div');
        translitElem.className = 'transliteration';
        translitElem.textContent = transliteration;
        element.appendChild(translitElem);
    } else if (translitElem) {
        if (translitElem.style.display !== 'none') {
            translitElem.style.display = 'none';
        } else {
            translitElem.style.display = 'block';
        }
    }
}

    function showAllTransliterations() {
        let wordBoxes = document.querySelectorAll('.word-box');
        wordBoxes.forEach(box => {
            let transliteration = box.getAttribute('data-transliteration');
            if (transliteration) {
                let translitElem = box.querySelector('.transliteration');
                if (!translitElem) {
                    translitElem = document.createElement('div');
                    translitElem.className = 'transliteration';
                    translitElem.textContent = transliteration;
                    box.appendChild(translitElem);
                } else {
                    translitElem.style.display = 'block';
                }
            }
        });
    }

    function clearAllTransliterations() {
    let translitElements = document.querySelectorAll('.transliteration');
    translitElements.forEach(elem => {
        elem.style.display = 'none';
    });
}


    // Display the text and make words clickable
    function displayText() {
        loadText(function(text) {
            if (!text) {
                console.error("No text loaded from pt.txt");
                return;
            }
            
            loadTransliterations(function(transliterations) {
                if (!transliterations) {
                    console.error("No transliterations loaded");
                    return;
                }

                let htmlContent = text.split(/(\s+|\n+)/).map(segment => {
                    if (segment === '\n') {
                        return segment;  // Preserve newlines
                    }
                    let cleanSegment = segment.toLowerCase().replace(/[\n,.\d:;?‚Äò‚Äô]/g, ''); // Clean specified punctuation
                    if (transliterations[cleanSegment]) {
                        return `<span class="word-box" data-transliteration="${transliterations[cleanSegment]}" onclick="toggleTransliteration(this)">${segment}</span>`;
                    } else {
                        return segment;
                    }
                }).join('');

                document.getElementById('content').innerHTML = htmlContent;
            });
        });
    }

    displayText();
</script>

</body>
</html>
